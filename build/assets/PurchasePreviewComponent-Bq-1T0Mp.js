var k=s=>{throw TypeError(s)};var P=(s,a,t)=>a.has(s)||k("Cannot "+t);var r=(s,a,t)=>(P(s,a,"read from private field"),t?t.call(s):a.get(s)),j=(s,a,t)=>a.has(s)?k("Cannot add the same private member more than once"):a instanceof WeakSet?a.add(s):a.set(s,t),O=(s,a,t,i)=>(P(s,a,"write to private field"),i?i.call(s,t):a.set(s,t),t),v=(s,a,t)=>(P(s,a,"access private method"),t);import{aW as W,aX as q,aY as B,aZ as H,a_ as F,a$ as Y,r as N,b0 as z,b1 as Q,a as X,az as L,A as M,e as Z,j as n,m as E}from"./index-pNvrWSmY.js";import{R as G}from"./index-CD8KK78h.js";var w,g,c,f,b,D,A,K,J=(K=class extends W{constructor(a,t){super();j(this,b);j(this,w);j(this,g);j(this,c);j(this,f);O(this,w,a),this.setOptions(t),this.bindMethods(),v(this,b,D).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(a){var i;const t=this.options;this.options=r(this,w).defaultMutationOptions(a),q(this.options,t)||r(this,w).getMutationCache().notify({type:"observerOptionsUpdated",mutation:r(this,c),observer:this}),t!=null&&t.mutationKey&&this.options.mutationKey&&B(t.mutationKey)!==B(this.options.mutationKey)?this.reset():((i=r(this,c))==null?void 0:i.state.status)==="pending"&&r(this,c).setOptions(this.options)}onUnsubscribe(){var a;this.hasListeners()||(a=r(this,c))==null||a.removeObserver(this)}onMutationUpdate(a){v(this,b,D).call(this),v(this,b,A).call(this,a)}getCurrentResult(){return r(this,g)}reset(){var a;(a=r(this,c))==null||a.removeObserver(this),O(this,c,void 0),v(this,b,D).call(this),v(this,b,A).call(this)}mutate(a,t){var i;return O(this,f,t),(i=r(this,c))==null||i.removeObserver(this),O(this,c,r(this,w).getMutationCache().build(r(this,w),this.options)),r(this,c).addObserver(this),r(this,c).execute(a)}},w=new WeakMap,g=new WeakMap,c=new WeakMap,f=new WeakMap,b=new WeakSet,D=function(){var t;const a=((t=r(this,c))==null?void 0:t.state)??H();O(this,g,{...a,isPending:a.status==="pending",isSuccess:a.status==="success",isError:a.status==="error",isIdle:a.status==="idle",mutate:this.mutate,reset:this.reset})},A=function(a){F.batch(()=>{var t,i,l,o,e,u,h,p;if(r(this,f)&&this.hasListeners()){const x=r(this,g).variables,d=r(this,g).context;(a==null?void 0:a.type)==="success"?((i=(t=r(this,f)).onSuccess)==null||i.call(t,a.data,x,d),(o=(l=r(this,f)).onSettled)==null||o.call(l,a.data,null,x,d)):(a==null?void 0:a.type)==="error"&&((u=(e=r(this,f)).onError)==null||u.call(e,a.error,x,d),(p=(h=r(this,f)).onSettled)==null||p.call(h,void 0,a.error,x,d))}this.listeners.forEach(x=>{x(r(this,g))})})},K);function V(s,a){const t=Y(),[i]=N.useState(()=>new J(t,s));N.useEffect(()=>{i.setOptions(s)},[i,s]);const l=N.useSyncExternalStore(N.useCallback(e=>i.subscribe(F.batchCalls(e)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),o=N.useCallback((e,u)=>{i.mutate(e,u).catch(z)},[i]);if(l.error&&Q(i.options.throwOnError,[l.error]))throw l.error;return{...l,mutate:o,mutateAsync:l.mutate}}const y={MATERIAL:"material",BOOK:"book",PAPER:"paper"},I=s=>L(`${M.DOWNLOAD_MATERIAL}/${s}`),ss=s=>L(`${M.DOWNLOAD_BOOK}/${s}`),as=s=>L(`${M.DOWNLOAD_PAPER}/${s}`),ts=async(s,a="download")=>{try{const t=await fetch(s);if(!t.ok)throw new Error(`Failed to fetch file: ${t.status}`);const i=await t.blob();let l=a;const o=t.headers.get("Content-Disposition");if(o&&o.includes("filename=")){const h=o.match(/filename="?([^"]+)"?/);h&&h[1]&&(l=h[1])}else{const p=new URL(s).pathname;l=decodeURIComponent(p.substring(p.lastIndexOf("/")+1).split("?")[0])}const e=window.URL.createObjectURL(i),u=document.createElement("a");u.href=e,u.download=l,document.body.appendChild(u),u.click(),document.body.removeChild(u),setTimeout(()=>{window.URL.revokeObjectURL(e)},100)}catch{const i=document.createElement("a");i.href=s,i.download=a,i.target="_blank",i.rel="noopener noreferrer",document.body.appendChild(i),i.click(),document.body.removeChild(i)}},_=(s=y.MATERIAL)=>{const{showToast:a}=X(),i=V({mutationFn:(()=>{switch(s){case y.BOOK:return ss;case y.PAPER:return as;case y.MATERIAL:default:return I}})(),onSuccess:async o=>{var e;try{const{download_url:u,expires_in:h}=((e=o==null?void 0:o.data)==null?void 0:e.data)||{};if(!u)throw new Error("Download URL not provided");a("Download started successfully!","success");const x=new URL(u).pathname,d=decodeURIComponent(x.substring(x.lastIndexOf("/")+1).split("?")[0]),R=d.includes(".")?d:`${s}-${Date.now()}.pdf`;await ts(u,R)}catch{a("Download failed to process","error")}},onError:o=>{var u,h;const e=((h=(u=o==null?void 0:o.response)==null?void 0:u.data)==null?void 0:h.message)||"Download failed. Please try again.";a(e,"error")}});return{initiateDownload:(o,e="")=>{if(!o){a("Invalid item ID for download","error");return}a(`Preparing download${e?` for "${e}"`:""}...`,"info"),i.mutate(o)},isLoading:i.isPending,error:i.error,isSuccess:i.isSuccess,reset:i.reset}},os=()=>_(y.MATERIAL),es=()=>_(y.BOOK),us=()=>_(y.PAPER),ls=({selectedItem:s,rating:a,views:t,useCoins:i,setUseCoins:l,handlePurchaseClick:o,handleDownloadClick:e,loading:u,downloadLoading:h=!1})=>{var x,d,C,R,U,S,$,T;const{theme:p}=Z();return n.jsxs(E.div,{className:"flex flex-col md:flex-row gap-6 mt-10 px-4 md:px-10 lg:px-20",initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{duration:.6,ease:"easeOut"},children:[n.jsxs(E.div,{className:"bg-white rounded-lg shadow-md flex flex-col flex-1 p-6 h-full",initial:{opacity:0,x:-40},animate:{opacity:1,x:0},transition:{delay:.2,duration:.5},children:[n.jsx("h3",{className:"text-3xl font-bold text-gray-800 mb-2",children:s==null?void 0:s.title}),n.jsxs("div",{className:"flex flex-wrap items-center text-sm text-gray-600 gap-2 mb-4",children:[(x=s==null?void 0:s.categories)==null?void 0:x.map(m=>n.jsx("span",{className:"bg-blue-100 text-blue-800 py-1 px-2 rounded text-xs font-medium",children:m.category},m.id)),(d=s==null?void 0:s.standards)==null?void 0:d.map(m=>n.jsxs("span",{className:"bg-green-100 text-green-800 py-1 px-2 rounded text-xs font-medium",children:["Std ",m.standard]},m.id)),n.jsx("span",{className:"bg-purple-100 text-purple-800 py-1 px-2 rounded text-xs font-medium",children:(C=s==null?void 0:s.language)==null?void 0:C.language})]}),n.jsxs("div",{className:"flex items-center mb-6",children:[n.jsx("span",{className:"text-sm text-gray-700",children:a}),n.jsx(G,{className:"px-2",value:a,disabled:!0,allowHalf:!0}),n.jsx("span",{className:"text-sm text-gray-500",children:t?`(${t})`:""})]}),n.jsxs("div",{className:"mb-6",children:[n.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Description"}),n.jsx("p",{className:"text-gray-700 leading-relaxed",children:s==null?void 0:s.description})]}),n.jsxs("div",{className:"flex items-center gap-4 mt-auto",children:[n.jsx("img",{src:(R=s==null?void 0:s.tutor)==null?void 0:R.profile_url,alt:(U=s==null?void 0:s.tutor)==null?void 0:U.name,className:"w-12 h-12 rounded-full object-cover border"}),n.jsxs("div",{children:[n.jsx("p",{className:"font-semibold text-gray-800",children:(S=s==null?void 0:s.tutor)==null?void 0:S.name}),n.jsxs("p",{className:"text-sm text-gray-500",children:[($=s==null?void 0:s.tutor)==null?void 0:$.standard,", ",(T=s==null?void 0:s.tutor)==null?void 0:T.school]})]})]})]}),n.jsxs(E.div,{className:"bg-white rounded-lg shadow-md flex flex-col w-full md:w-4/12 lg:w-3/12 p-6 h-full",initial:{opacity:0,x:40},animate:{opacity:1,x:0},transition:{delay:.3,duration:.5},children:[n.jsx(E.div,{className:"mb-4 w-full h-48 flex items-center justify-center",whileHover:{scale:1.05},transition:{type:"spring",stiffness:200},children:n.jsx("img",{className:"max-h-full max-w-full object-contain rounded",src:s==null?void 0:s.thumbnail_url,alt:"Book Thumbnail"})}),n.jsxs("div",{className:"flex flex-col flex-grow justify-between",children:[!(s!=null&&s.is_purchased)&&(s==null?void 0:s.is_paid)&&n.jsxs("div",{className:"flex items-center mb-4",children:[n.jsx("input",{id:"useCoins",type:"checkbox",checked:i,onChange:m=>l(m.target.checked),className:"accent-[#F68713] h-4 w-4 transform scale-150 mr-3"}),n.jsx("label",{htmlFor:"useCoins",className:"text-base text-gray-800",children:"Use My Coins"})]}),n.jsx("div",{className:"w-full mb-4",children:s!=null&&s.is_purchased||!(s!=null&&s.is_paid)?n.jsx("button",{onClick:()=>e==null?void 0:e(s==null?void 0:s.id,s==null?void 0:s.title),disabled:h,className:`w-full px-5 py-3 text-xl ${p.COLOR_BUTTON} ${h?"opacity-75 cursor-not-allowed":""}`,children:h?n.jsxs("div",{className:"flex items-center justify-center",children:[n.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Preparing..."]}):"Download"}):n.jsx("button",{onClick:o,disabled:u,className:`w-full px-5 py-3 text-xl ${p.COLOR_BUTTON}`,children:u?n.jsxs("div",{className:"flex items-center justify-center",children:[n.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Processing..."]}):"Purchase Now"})}),n.jsx("span",{className:"text-sm text-gray-600 text-center mt-auto",children:"Secure payment â€¢ Instant download"})]})]})]})};export{ls as P,es as a,us as b,os as u};
