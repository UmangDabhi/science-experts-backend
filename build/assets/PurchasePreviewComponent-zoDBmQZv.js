var U=s=>{throw TypeError(s)};var D=(s,a,t)=>a.has(s)||U("Cannot "+t);var o=(s,a,t)=>(D(s,a,"read from private field"),t?t.call(s):a.get(s)),j=(s,a,t)=>a.has(s)?U("Cannot add the same private member more than once"):a instanceof WeakSet?a.add(s):a.set(s,t),v=(s,a,t,r)=>(D(s,a,"write to private field"),r?r.call(s,t):a.set(s,t),t),N=(s,a,t)=>(D(s,a,"access private method"),t);import{aW as W,aX as q,aY as B,aZ as H,a_ as F,a$ as Y,r as O,b0 as z,b1 as Q,a as X,az as C,A as M,e as Z,j as i,m as R}from"./index-BjdLfJe7.js";import{R as G}from"./index-Wet8TwpU.js";var w,y,h,d,p,P,A,K,J=(K=class extends W{constructor(a,t){super();j(this,p);j(this,w);j(this,y);j(this,h);j(this,d);v(this,w,a),this.setOptions(t),this.bindMethods(),N(this,p,P).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(a){var r;const t=this.options;this.options=o(this,w).defaultMutationOptions(a),q(this.options,t)||o(this,w).getMutationCache().notify({type:"observerOptionsUpdated",mutation:o(this,h),observer:this}),t!=null&&t.mutationKey&&this.options.mutationKey&&B(t.mutationKey)!==B(this.options.mutationKey)?this.reset():((r=o(this,h))==null?void 0:r.state.status)==="pending"&&o(this,h).setOptions(this.options)}onUnsubscribe(){var a;this.hasListeners()||(a=o(this,h))==null||a.removeObserver(this)}onMutationUpdate(a){N(this,p,P).call(this),N(this,p,A).call(this,a)}getCurrentResult(){return o(this,y)}reset(){var a;(a=o(this,h))==null||a.removeObserver(this),v(this,h,void 0),N(this,p,P).call(this),N(this,p,A).call(this)}mutate(a,t){var r;return v(this,d,t),(r=o(this,h))==null||r.removeObserver(this),v(this,h,o(this,w).getMutationCache().build(o(this,w),this.options)),o(this,h).addObserver(this),o(this,h).execute(a)}},w=new WeakMap,y=new WeakMap,h=new WeakMap,d=new WeakMap,p=new WeakSet,P=function(){var t;const a=((t=o(this,h))==null?void 0:t.state)??H();v(this,y,{...a,isPending:a.status==="pending",isSuccess:a.status==="success",isError:a.status==="error",isIdle:a.status==="idle",mutate:this.mutate,reset:this.reset})},A=function(a){F.batch(()=>{var t,r,l,n,u,e,x,f;if(o(this,d)&&this.hasListeners()){const c=o(this,y).variables,b=o(this,y).context;(a==null?void 0:a.type)==="success"?((r=(t=o(this,d)).onSuccess)==null||r.call(t,a.data,c,b),(n=(l=o(this,d)).onSettled)==null||n.call(l,a.data,null,c,b)):(a==null?void 0:a.type)==="error"&&((e=(u=o(this,d)).onError)==null||e.call(u,a.error,c,b),(f=(x=o(this,d)).onSettled)==null||f.call(x,void 0,a.error,c,b))}this.listeners.forEach(c=>{c(o(this,y))})})},K);function V(s,a){const t=Y(),[r]=O.useState(()=>new J(t,s));O.useEffect(()=>{r.setOptions(s)},[r,s]);const l=O.useSyncExternalStore(O.useCallback(u=>r.subscribe(F.batchCalls(u)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),n=O.useCallback((u,e)=>{r.mutate(u,e).catch(z)},[r]);if(l.error&&Q(r.options.throwOnError,[l.error]))throw l.error;return{...l,mutate:n,mutateAsync:l.mutate}}const m={MATERIAL:"material",BOOK:"book",PAPER:"paper"},I=s=>C(`${M.DOWNLOAD_MATERIAL}/${s}`),ss=s=>C(`${M.DOWNLOAD_BOOK}/${s}`),as=s=>C(`${M.DOWNLOAD_PAPER}/${s}`),ts=async(s,a)=>{try{const t=await fetch(s);if(!t.ok)throw new Error(`Failed to fetch file: ${t.status}`);const r=await t.blob(),l=window.URL.createObjectURL(r),n=document.createElement("a");n.href=l,n.download=a||"download",n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),setTimeout(()=>{window.URL.revokeObjectURL(l)},100)}catch{const r=document.createElement("a");r.href=s,r.download=a||"download",r.target="_blank",r.rel="noopener noreferrer",document.body.appendChild(r),r.click(),document.body.removeChild(r)}},L=(s=m.MATERIAL)=>{const{showToast:a}=X(),r=V({mutationFn:(()=>{switch(s){case m.BOOK:return ss;case m.PAPER:return as;case m.MATERIAL:default:return I}})(),onSuccess:async n=>{var u;try{const{download_url:e,expires_in:x}=((u=n==null?void 0:n.data)==null?void 0:u.data)||{};if(!e)throw new Error("Download URL not provided");a("Download started successfully!","success");const f=e.split("/"),c=f[f.length-1],E=c.includes(".")?c:`${s}-${Date.now()}.pdf`;await ts(e,E)}catch{a("Download failed to process","error")}},onError:n=>{var e,x;const u=((x=(e=n==null?void 0:n.response)==null?void 0:e.data)==null?void 0:x.message)||"Download failed. Please try again.";a(u,"error")}});return{initiateDownload:(n,u="")=>{if(!n){a("Invalid item ID for download","error");return}a(`Preparing download${u?` for "${u}"`:""}...`,"info"),r.mutate(n)},isLoading:r.isPending,error:r.error,isSuccess:r.isSuccess,reset:r.reset}},os=()=>L(m.MATERIAL),us=()=>L(m.BOOK),es=()=>L(m.PAPER),ls=({selectedItem:s,rating:a,views:t,useCoins:r,setUseCoins:l,handlePurchaseClick:n,handleDownloadClick:u,loading:e,downloadLoading:x=!1})=>{var c,b,E,_,S,$,T,k;const{theme:f}=Z();return i.jsxs(R.div,{className:"flex flex-col md:flex-row gap-6 mt-10 px-4 md:px-10 lg:px-20",initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{duration:.6,ease:"easeOut"},children:[i.jsxs(R.div,{className:"bg-white rounded-lg shadow-md flex flex-col flex-1 p-6 h-full",initial:{opacity:0,x:-40},animate:{opacity:1,x:0},transition:{delay:.2,duration:.5},children:[i.jsx("h3",{className:"text-3xl font-bold text-gray-800 mb-2",children:s==null?void 0:s.title}),i.jsxs("div",{className:"flex flex-wrap items-center text-sm text-gray-600 gap-2 mb-4",children:[(c=s==null?void 0:s.categories)==null?void 0:c.map(g=>i.jsx("span",{className:"bg-blue-100 text-blue-800 py-1 px-2 rounded text-xs font-medium",children:g.category},g.id)),(b=s==null?void 0:s.standards)==null?void 0:b.map(g=>i.jsxs("span",{className:"bg-green-100 text-green-800 py-1 px-2 rounded text-xs font-medium",children:["Std ",g.standard]},g.id)),i.jsx("span",{className:"bg-purple-100 text-purple-800 py-1 px-2 rounded text-xs font-medium",children:(E=s==null?void 0:s.language)==null?void 0:E.language})]}),i.jsxs("div",{className:"flex items-center mb-6",children:[i.jsx("span",{className:"text-sm text-gray-700",children:a}),i.jsx(G,{className:"px-2",value:a,disabled:!0,allowHalf:!0}),i.jsx("span",{className:"text-sm text-gray-500",children:t?`(${t})`:""})]}),i.jsxs("div",{className:"mb-6",children:[i.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Description"}),i.jsx("p",{className:"text-gray-700 leading-relaxed",children:s==null?void 0:s.description})]}),i.jsxs("div",{className:"flex items-center gap-4 mt-auto",children:[i.jsx("img",{src:(_=s==null?void 0:s.tutor)==null?void 0:_.profile_url,alt:(S=s==null?void 0:s.tutor)==null?void 0:S.name,className:"w-12 h-12 rounded-full object-cover border"}),i.jsxs("div",{children:[i.jsx("p",{className:"font-semibold text-gray-800",children:($=s==null?void 0:s.tutor)==null?void 0:$.name}),i.jsxs("p",{className:"text-sm text-gray-500",children:[(T=s==null?void 0:s.tutor)==null?void 0:T.standard,", ",(k=s==null?void 0:s.tutor)==null?void 0:k.school]})]})]})]}),i.jsxs(R.div,{className:"bg-white rounded-lg shadow-md flex flex-col w-full md:w-4/12 lg:w-3/12 p-6 h-full",initial:{opacity:0,x:40},animate:{opacity:1,x:0},transition:{delay:.3,duration:.5},children:[i.jsx(R.div,{className:"mb-4 w-full h-48 flex items-center justify-center",whileHover:{scale:1.05},transition:{type:"spring",stiffness:200},children:i.jsx("img",{className:"max-h-full max-w-full object-contain rounded",src:s==null?void 0:s.thumbnail_url,alt:"Book Thumbnail"})}),i.jsxs("div",{className:"flex flex-col flex-grow justify-between",children:[!(s!=null&&s.is_purchased)&&(s==null?void 0:s.is_paid)&&i.jsxs("div",{className:"flex items-center mb-4",children:[i.jsx("input",{id:"useCoins",type:"checkbox",checked:r,onChange:g=>l(g.target.checked),className:"accent-[#F68713] h-4 w-4 transform scale-150 mr-3"}),i.jsx("label",{htmlFor:"useCoins",className:"text-base text-gray-800",children:"Use My Coins"})]}),i.jsx("div",{className:"w-full mb-4",children:s!=null&&s.is_purchased||!(s!=null&&s.is_paid)?i.jsx("button",{onClick:()=>u==null?void 0:u(s==null?void 0:s.id,s==null?void 0:s.title),disabled:x,className:`w-full px-5 py-3 text-xl ${f.COLOR_BUTTON} ${x?"opacity-75 cursor-not-allowed":""}`,children:x?i.jsxs("div",{className:"flex items-center justify-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Preparing..."]}):"Download"}):i.jsx("button",{onClick:n,disabled:e,className:`w-full px-5 py-3 text-xl ${f.COLOR_BUTTON}`,children:e?i.jsxs("div",{className:"flex items-center justify-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Processing..."]}):"Purchase Now"})}),i.jsx("span",{className:"text-sm text-gray-600 text-center mt-auto",children:"Secure payment â€¢ Instant download"})]})]})]})};export{ls as P,us as a,es as b,os as u};
