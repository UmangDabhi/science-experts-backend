import{aw as r,ax as S,A as n,ay as k,az as M,aA as y,aB as v,aC as A,z as D,f as g,r as u,a as U,u as $,aD as z,K as F,ar as B,e as G,j as s,b as I,s as Y}from"./index-9u-Z54xc.js";import{C}from"./CourseDetailHeader-CgqscJ7T.js";import{u as H,P as q}from"./useRazorpayPayment-kWBuFlcX.js";import"./Icons-Cwh9a9lS.js";import"./index-O8gkXI22.js";import"./ContextIsolator-Qp2QtNF2.js";import"./index-B0jPUqxI.js";import"./index-CdTTC2gm.js";import"./actions-DNe8e-Zl.js";const K=r("enrollment/create_enrollment",k,n.CREATE_ENROLLMENT),V=r("enrollment/get_all_enrollments",y,a=>M(n.GET_ALL_ENROLLMENT,a));r(n.GET_ENROLLMENT,y,a=>n.GET_ENROLLMENT+"/"+a.id);r(n.UPDATE_ENROLLMENT,v,a=>n.UPDATE_ENROLLMENT+"/"+a.id);r(n.DELETE_ENROLLMENT,A,a=>n.DELETE_ENROLLMENT+"/"+a.id);const W={enrollments:[],selectedEnrollment:{},totalEnrollments:0};S({name:"enrollment",initialState:W,reducers:{resetEnrollmentSlice:a=>{a.enrollments=[],a.selectedEnrollment={},a.totalEnrollments=0},setEnrollment:(a,t)=>{a.selectedEnrollment=t.payload},deselectEnrollment:a=>{a.selectedEnrollment={}}},extraReducers:a=>{a.addCase(V.fulfilled,(t,e)=>{t.enrollments=e.payload.data.data,t.totalEnrollments=e.payload.data.total}).addCase(getCourseEnrollment.fulfilled,(t,e)=>{t.enrollments=e.payload.data})}});const re=()=>{var N;const{dispatch:a}=Y,{courseId:t}=D(),{selectedCourse:e,courses:J}=g(l=>l.course),{userDetails:i}=g(l=>l.auth),{initiatePayment:L,razorpayDivRef:Q}=H(),[_,c]=u.useState(!1),[p,j]=u.useState(!1),{showToast:d}=U(),R=$(),{openPrompt:w}=z(),P=()=>{c(!0),L({useCoins:p,type:q.COURSE,itemId:e==null?void 0:e.id,name:e==null?void 0:e.title,description:e==null?void 0:e.description,user:{name:i.name,email:i.email,contact:i.phone_no||""},onSuccess:l=>{E(),d("Enrollment Success!")}}).finally(()=>c(!1))},b=()=>{c(!0),a(K({course:t})).unwrap().then(o=>{d(o.message),setTimeout(()=>{var T;R(`/course/view/${e==null?void 0:e.id}/module/${(T=e==null?void 0:e.modules[0])==null?void 0:T.id}`)},500)}).catch(o=>{d((o==null?void 0:o.message)||"Enrollment Failed","error")}).finally(()=>{c(!1),E()})},O=()=>{if(!i){w();return}e!=null&&e.is_paid?P():b()};u.useEffect(()=>{t&&E()},[t]);const E=()=>{a(F({id:t}))};B(e);const{theme:h}=G(),m=!!(e!=null&&e.is_paid),x=!!(e!=null&&e.is_enrolled),f=(e==null?void 0:e.price)*(100-(e==null?void 0:e.discount))/100;return s.jsxs("div",{children:[s.jsx(C,{selectedCourse:e,isEnroll:!0}),s.jsxs("div",{className:"p-6 font-bold",children:[s.jsxs("p",{className:"text-2xl flex flex-col md:flex-row md:justify-between md:items-center gap-4",children:[s.jsx("span",{children:"Summary"}),s.jsxs("div",{className:"flex flex-col md:flex-row gap-2 md:gap-4",children:[!x&&m&&s.jsxs("div",{className:"flex items-center",children:[s.jsx("input",{id:"useCoins",type:"checkbox",checked:p,onChange:l=>j(l.target.checked),className:"accent-[#F68713] h-4 w-4 transform scale-150"}),s.jsx("label",{htmlFor:"useCoins",className:"mx-3 text-xl",children:"Use My Coins"})]}),x?s.jsx(I,{className:`px-5 py-3 text-xl ${h.COLOR_BUTTON}`,to:`/course/view/${e==null?void 0:e.id}/module/${(N=e==null?void 0:e.modules[0])==null?void 0:N.id}`,children:"View Now"}):s.jsx("button",{onClick:O,disabled:_,className:`px-5 py-3 text-xl ${h.COLOR_BUTTON}`,children:m?"Purchase Now":"Enroll Now"})]})]}),s.jsx("p",{className:"text-xl mt-4",children:m?s.jsxs(s.Fragment,{children:["Total: ₹ ",f]}):s.jsx("span",{className:"text-primary font-semibold",children:"Free to Enroll"})}),m?s.jsxs("p",{children:["No refunds or credits for partial course periods unless required by law. Your course access begins immediately upon purchase with an initial charge of ₹ ",f,'. To avoid additional charges, cancel before the start of any future billing periods. By clicking "Start Course" you agree to our Terms and authorize recurring charges for future access.']}):s.jsx("p",{children:'This course is free to enroll. Click "Enroll Now" to get instant access!'})]})]})};export{re as default};
